<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Scheduler Comparison</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: sans-serif;
            text-align: center;
            background-color: #f4f4f4;
            margin: 0;
            padding: 0;
        }
        h1 {
            margin-top: 30px;
        }
        button {
            padding: 10px 25px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            margin-top: 10px;
        }
        button:hover {
            background: #0056b3;
        }

        /* Layout container */
        .container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 30px;
            margin-top: 30px;
        }

        .row {
            display: flex;
            justify-content: center;
            gap: 40px;
            flex-wrap: wrap;
        }

        .graph {
            width: 400px;
            background: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }

        canvas {
            width: 100%;
            height: 250px;
        }
    </style>
</head>
<body>
    <h1>CPU vs GPU vs GPU+SJF Scheduler Comparison</h1>
    <button onclick="startJobs()">Run Schedulers</button>

    <div class="container">
        <!-- Row 1: CPU -->
        <div class="row">
            <div class="graph">
                <h2>CPU Scheduler</h2>
                <canvas id="cpuChart"></canvas>
            </div>
        </div>

        <!-- Row 2: GPU and GPU+SJF -->
        <div class="row">
            <div class="graph">
                <h2>GPU Scheduler</h2>
                <canvas id="gpuChart"></canvas>
            </div>
            <div class="graph">
                <h2>GPU + SJF Scheduler</h2>
                <canvas id="sjfChart"></canvas>
            </div>
        </div>
    </div>

    <script>
        const charts = {
            cpu: new Chart(document.getElementById('cpuChart'), {
                type: 'line',
                data: { labels: [], datasets: [{ label: 'CPU Usage %', data: [], borderColor: 'red', tension: 0.2 }] },
                options: { animation: false, scales: { y: { min: 0, max: 100 } } }
            }),
            gpu: new Chart(document.getElementById('gpuChart'), {
                type: 'line',
                data: { labels: [], datasets: [{ label: 'GPU Usage %', data: [], borderColor: 'blue', tension: 0.2 }] },
                options: { animation: false, scales: { y: { min: 0, max: 100 } } }
            }),
            sjf: new Chart(document.getElementById('sjfChart'), {
                type: 'line',
                data: { labels: [], datasets: [{ label: 'GPU+SJF Usage %', data: [], borderColor: 'green', tension: 0.2 }] },
                options: { animation: false, scales: { y: { min: 0, max: 100 } } }
            })
        };

        async function startJobs() {
            await fetch('/submit_job', { method: 'POST' });
            updateCharts();
        }

        async function updateCharts() {
            const res = await fetch('/usage_data');
            const data = await res.json();

            data.forEach(sched => {
                let chart;
                if (sched.name === "CPU") chart = charts.cpu;
                else if (sched.name === "GPU") chart = charts.gpu;
                else chart = charts.sjf;

                chart.data.labels = sched.usage.map((_, i) => i + 1);
                chart.data.datasets[0].data = sched.usage;
                chart.update();

                if (!sched.running && sched.total_time > 0) {
                    const div = chart.canvas.parentElement;
                    let timeText = div.querySelector('.time');
                    if (!timeText) {
                        timeText = document.createElement('p');
                        timeText.classList.add('time');
                        div.appendChild(timeText);
                    }
                    timeText.textContent = `Total Time: ${sched.total_time} sec`;
                }
            });

            setTimeout(updateCharts, 1000);
        }
    </script>
</body>
</html>
